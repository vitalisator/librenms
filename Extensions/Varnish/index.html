
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreNMS user and developer documentation">
      
      
        <link rel="canonical" href="http://docs.librenms.org/Extensions/Varnish/">
      
      
        <meta name="author" content="LibreNMS">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.0">
    
    
      
        <title>Varnish - LibreNMS Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bc7e593a.min.css">
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="../../librenms.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-79149977-2","docs.librenms.org"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#varnish-installation-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="http://docs.librenms.org" title="LibreNMS Docs" class="md-header-nav__button md-logo" aria-label="LibreNMS Docs">
      
  <img src="../../img/librenms.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            LibreNMS Docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Varnish
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/librenms/librenms/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="http://docs.librenms.org" title="LibreNMS Docs" class="md-nav__button md-logo" aria-label="LibreNMS Docs">
      
  <img src="../../img/librenms.svg" alt="logo">

    </a>
    LibreNMS Docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/librenms/librenms/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      1. General
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="1. General" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        1. General
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../General/Acknowledgement/" class="md-nav__link">
      Acknowledgements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../General/Changelog/" class="md-nav__link">
      Changelog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../General/CODE_OF_CONDUCT/" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Features/" class="md-nav__link">
      Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../General/Welcome-to-Observium-users/" class="md-nav__link">
      Welcome to Observium users
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      2. Installing
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="2. Installing" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        2. Installing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Installation/" class="md-nav__link">
      How to install LibreNMS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Installation/Install-LibreNMS/" class="md-nav__link">
      Install LibreNMS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Installation/Images/" class="md-nav__link">
      LibreNMS VMs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Installation/Migrating-from-Observium/" class="md-nav__link">
      Migrating from Observium
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      3. Getting started
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="3. Getting started" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        3. Getting started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../General/Releases/" class="md-nav__link">
      Choosing a release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Adding-a-Device/" class="md-nav__link">
      Adding a device
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Device-Groups/" class="md-nav__link">
      Grouping Devices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../General/Callback-Stats-and-Privacy/" class="md-nav__link">
      Submitting stats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../General/Updating/" class="md-nav__link">
      Updating an install
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      4. Basic Setup
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="4. Basic Setup" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        4. Basic Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Applications/" class="md-nav__link">
      Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Agent-Setup/" class="md-nav__link">
      Check_MK Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Billing-Module/" class="md-nav__link">
      Billing Module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Dell-OpenManage/" class="md-nav__link">
      Dell OpenManage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../World-Map/" class="md-nav__link">
      World Map
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Interface-Description-Parsing/" class="md-nav__link">
      Interface Description Parsing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Network-Map/" class="md-nav__link">
      Network Map
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Syslog/" class="md-nav__link">
      Syslog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Dashboards/" class="md-nav__link">
      Dashboards
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Supermicro/" class="md-nav__link">
      Supermicro
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      5. Advanced Setup
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="5. Advanced Setup" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        5. Advanced Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/1-Minute-Polling/" class="md-nav__link">
      1 Minute Polling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fast-Ping-Check/" class="md-nav__link">
      Fast Ping Checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Environment-Variables/" class="md-nav__link">
      Environment Variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Configuration/" class="md-nav__link">
      Configuration Docs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Authentication/" class="md-nav__link">
      Authentication Options
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Two-Factor-Auth/" class="md-nav__link">
      Two-Factor Auth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Auto-Discovery/" class="md-nav__link">
      Auto-discovery Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Distributed-Poller/" class="md-nav__link">
      Scaling LibreNMS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RRDCached/" class="md-nav__link">
      RRDCached
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Sub-Directory/" class="md-nav__link">
      Sub-directory Support
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Varnish
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Dispatcher-Service/" class="md-nav__link">
      Dispatcher Service (RC)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RRDTune/" class="md-nav__link">
      RRDTune
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../IRC-Bot/" class="md-nav__link">
      IRC Bot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../IRC-Bot-Extensions/" class="md-nav__link">
      IRC Bot Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SNMP-Proxy/" class="md-nav__link">
      SNMP Proxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SNMP-Trap-Handler/" class="md-nav__link">
      SNMP Trap Handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Customizing-the-Web-UI/" class="md-nav__link">
      Customizing the Web UI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Bare-Dashboard/" class="md-nav__link">
      Bare Dashboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Cleanup-options/" class="md-nav__link">
      Cleanup Options
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      6. 3rd Party Integration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="6. 3rd Party Integration" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        6. 3rd Party Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Gateone/" class="md-nav__link">
      Gateone
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Graylog/" class="md-nav__link">
      Graylog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Services/" class="md-nav__link">
      Nagios Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../NFSen/" class="md-nav__link">
      NFSen
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Oxidized/" class="md-nav__link">
      Oxidized
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Rancid/" class="md-nav__link">
      Rancid
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../PeeringDB/" class="md-nav__link">
      PeeringDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Proxmox/" class="md-nav__link">
      Proxmox
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-9" type="checkbox" id="nav-7-9">
    
    <label class="md-nav__link" for="nav-7-9">
      Storing Metrics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Storing Metrics" data-md-level="2">
      <label class="md-nav__title" for="nav-7-9">
        <span class="md-nav__icon md-icon"></span>
        Storing Metrics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Metric-Storage/" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../metrics/Graphite/" class="md-nav__link">
      Graphite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../metrics/InfluxDB/" class="md-nav__link">
      InfluxDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../metrics/OpenTSDB/" class="md-nav__link">
      OpenTSDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../metrics/Prometheus/" class="md-nav__link">
      Prometheus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Smokeping/" class="md-nav__link">
      Smokeping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Weathermap/" class="md-nav__link">
      Weathermap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      7. API
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="7. API" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        7. API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/" class="md-nav__link">
      Using the API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/Devices/" class="md-nav__link">
      Devices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/DeviceGroups/" class="md-nav__link">
      DeviceGroups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/Ports/" class="md-nav__link">
      Ports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/PortGroups/" class="md-nav__link">
      PortGroups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/Alerts/" class="md-nav__link">
      Alerts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/Routing/" class="md-nav__link">
      Routing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/Switching/" class="md-nav__link">
      Switching
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/Inventory/" class="md-nav__link">
      Inventory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/Bills/" class="md-nav__link">
      Bills
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/ARP/" class="md-nav__link">
      ARP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/Services/" class="md-nav__link">
      Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/System/" class="md-nav__link">
      System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/Logs/" class="md-nav__link">
      Logs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/Locations/" class="md-nav__link">
      Locations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      8. Alerting
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="8. Alerting" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        8. Alerting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Alerting/" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Alerting/Introduction/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Alerting/Rules/" class="md-nav__link">
      Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Alerting/Templates/" class="md-nav__link">
      Templates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Alerting/Transports/" class="md-nav__link">
      Transports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Alerting/Creating-Transport/" class="md-nav__link">
      Creating Transports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Alerting/Entities/" class="md-nav__link">
      Entities
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Alerting/Macros/" class="md-nav__link">
      Macros
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Alerting/Testing/" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Alerting/Device-Dependencies/" class="md-nav__link">
      Device Dependencies
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      9. Getting help
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="9. Getting help" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon"></span>
        9. Getting help
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/" class="md-nav__link">
      How to get help
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/FAQ/" class="md-nav__link">
      FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Install%20Validation/" class="md-nav__link">
      Install Validation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Performance/" class="md-nav__link">
      Performance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Discovery%20Support/" class="md-nav__link">
      Discovery Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Poller%20Support/" class="md-nav__link">
      Poller Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Example-Hardware-Setup/" class="md-nav__link">
      Example Hardware Setups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Remote-Monitoring-VPN/" class="md-nav__link">
      Remote Monitoring VPN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/SNMP-Configuration-Examples/" class="md-nav__link">
      SNMP Configuration Examples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/SSL-Configuration/" class="md-nav__link">
      SSL Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Device-Troubleshooting/" class="md-nav__link">
      Device Troubleshooting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Device-Sensors/" class="md-nav__link">
      Device Sensors
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      10. Contributing + Developing
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="10. Contributing + Developing" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon"></span>
        10. Contributing + Developing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/" class="md-nav__link">
      Contributing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Getting-Started/" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Using-Git/" class="md-nav__link">
      Using Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Code-Guidelines/" class="md-nav__link">
      Code Guidelines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Style-Guidelines/" class="md-nav__link">
      Style Guidelines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Validating-Code/" class="md-nav__link">
      Validating Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Code-Structure/" class="md-nav__link">
      Code Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Creating-Documentation/" class="md-nav__link">
      Creating Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Licensing/" class="md-nav__link">
      Licensing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Component/" class="md-nav__link">
      Component
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11-11" type="checkbox" id="nav-11-11">
    
    <label class="md-nav__link" for="nav-11-11">
      Support for a new OS
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Support for a new OS" data-md-level="2">
      <label class="md-nav__title" for="nav-11-11">
        <span class="md-nav__icon md-icon"></span>
        Support for a new OS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Support-New-OS/" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/os/Initial-Detection/" class="md-nav__link">
      Initial Detection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/os/Mem-CPU-Information/" class="md-nav__link">
      Mem/CPU Information
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/os/Test-Units/" class="md-nav__link">
      Test Units
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/os/Health-Information/" class="md-nav__link">
      Health Information
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/os/Wireless-Sensors/" class="md-nav__link">
      Wireless Sensors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/os/Custom-Graphs/" class="md-nav__link">
      Custom Graphs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/os/Settings/" class="md-nav__link">
      Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Sensor-State-Support/" class="md-nav__link">
      Sensor State Support
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/SNMP-Traps/" class="md-nav__link">
      SNMP Traps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Dynamic-Config/" class="md-nav__link">
      Dynamic Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Merging-Pull-Requests/" class="md-nav__link">
      Merging Pull Requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developing/Creating-Release/" class="md-nav__link">
      Creating Release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Plugin-System/" class="md-nav__link">
      Plugin System
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      11. Misc
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="11. Misc" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon"></span>
        11. Misc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../General/Security/" class="md-nav__link">
      Security information
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/CLI-Tools/" class="md-nav__link">
      CLI Scripts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12-3" type="checkbox" id="nav-12-3">
    
    <label class="md-nav__link" for="nav-12-3">
      Device Notes
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Device Notes" data-md-level="2">
      <label class="md-nav__title" for="nav-12-3">
        <span class="md-nav__icon md-icon"></span>
        Device Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Device-Notes/" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Device-Notes/Carel-pCOweb-Devices/" class="md-nav__link">
      Carel pCOweb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Device-Notes/AsuswrtMerlin/" class="md-nav__link">
      Asuswrt-Merlin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Support/Device-Notes/Openwrt/" class="md-nav__link">
      OpenWRT
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/librenms/librenms/edit/master/doc/Extensions/Varnish.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="varnish-installation-guide">Varnish Installation Guide</h1>
<p>This document explains how to install Varnish Reverse Proxy for LibreNMS.</p>
<p>Varnish is caching software that sits logically between an HTTP client
and an HTTP server. Varnish caches HTTP responses from the HTTP
server. If an HTTP request can not be responded to by the Varnish
cache it directs the request to the HTTP Server. This type of HTTP
caching is called a reverse proxy server. Caching your HTTP server can
decrease page load times significantly.</p>
<h1 id="simplified-block-diagram-of-an-apache-http-server-with-varnish-40-reverse-proxy">Simplified block diagram of an Apache HTTP server with Varnish 4.0 Reverse Proxy</h1>
<p><img alt="Block Diagram 1" src="http://docs.librenms.org/img/varnish_block.png" /></p>
<h1 id="centos-7-varnish-installation">CentOS 7 Varnish Installation</h1>
<p>In this example we will assume your Apache 2.4.X HTTP server is working and
configured to process HTTP requests on port 80.  If not, please see
<a href="http://librenms.readthedocs.org/Installation/Installing-CentOS-7-Apache">Installing LibreNMS</a></p>
<h1 id="install-varnish-40-rpm">Install Varnish 4.0 RPM</h1>
<ul>
<li>Enable the Varnish CentOS 7 repo and install</li>
</ul>
<div class="highlight"><pre><span></span><code>rpm --nosignature -i https://repo.varnish-cache.org/redhat/varnish-4.0.el7.rpm
yum install varnish
</code></pre></div>
<p>By default Varnish listens for HTTP requests on port 6081.</p>
<ul>
<li>Temporarily add a firewalld rule for testing Varnish.</li>
</ul>
<div class="highlight"><pre><span></span><code>firewall-cmd --zone<span class="o">=</span>public --add-port<span class="o">=</span><span class="m">6081</span>/tcp
</code></pre></div>
<h1 id="test-varnish">Test Varnish</h1>
<ul>
<li>Start Varnish</li>
</ul>
<div class="highlight"><pre><span></span><code>systemctl start varnish
</code></pre></div>
<p>Using a web browser navigate to <server ip addr>:6081 or
127.0.0.1:6081. You should see a Varnish error message, this shows
that Varnish is working. Example error message:</p>
<div class="highlight"><pre><span></span><code>Error 503 Backend fetch failed

Backend fetch failed

Guru Meditation:

XID: 3

Varnish cache server
</code></pre></div>
<h1 id="edit-varnish-parameters">Edit Varnish Parameters</h1>
<p>Now we need to configure Varnish to listen to HTTP requests on port 80 and
relay those requests to the Apache HTTP server on port 8080 (see block diagram).</p>
<ul>
<li>Stop Varnish.</li>
</ul>
<div class="highlight"><pre><span></span><code>systemctl stop varnish
</code></pre></div>
<ul>
<li>Create a back-up of varnish.params just in case you make a mistake.</li>
</ul>
<div class="highlight"><pre><span></span><code>cp /etc/varnish/varnish.params /etc/varnish/varnish.params.bak
</code></pre></div>
<ul>
<li>Edit the varnish.params config.</li>
</ul>
<div class="highlight"><pre><span></span><code>vim /etc/varnish/varnish.params
</code></pre></div>
<p>Set the VCL location, IP address, port, and cache location and
size. <code>malloc</code> sets the cache location to RAM, and <code>512M</code> sets the
cache size to 512MB.</p>
<div class="highlight"><pre><span></span><code><span class="n">VARNISH_LISTEN_ADDRESS</span><span class="o">=</span><span class="m">192</span><span class="o">.</span><span class="m">168</span><span class="o">.</span><span class="m">1</span><span class="o">.</span><span class="m">10</span>
<span class="n">VARNISH_LISTEN_PORT</span><span class="o">=</span><span class="m">80</span>
<span class="n">VARNISH_VCL_CONF</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">varnish</span><span class="o">/</span><span class="n">librenms</span><span class="o">.</span><span class="n">vcl</span>
<span class="n">VARNISH_STORAGE</span><span class="o">=</span><span class="s">&quot;malloc,512M&quot;</span>
</code></pre></div>
<p>Example varnish.params:</p>
<div class="highlight"><pre><span></span><code><span class="c"># Set this to 1 to make systemd reload try to switch vcl without restart.</span>
<span class="n">RELOAD_VCL</span><span class="o">=</span><span class="m">1</span>

<span class="c"># Main configuration file. You probably want to change it.</span>
<span class="n">VARNISH_VCL_CONF</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">varnish</span><span class="o">/</span><span class="n">librenms</span><span class="o">.</span><span class="n">vcl</span>

<span class="c"># Default address and port to bind to. Blank address means all IPv4</span>
<span class="c"># and IPv6 interfaces, otherwise specify a host name, an IPv4 dotted</span>
<span class="c"># quad, or an IPv6 address in brackets.</span>
<span class="n">VARNISH_LISTEN_ADDRESS</span><span class="o">=</span><span class="m">192</span><span class="o">.</span><span class="m">168</span><span class="o">.</span><span class="m">1</span><span class="o">.</span><span class="m">10</span>
<span class="n">VARNISH_LISTEN_PORT</span><span class="o">=</span><span class="m">80</span>

<span class="c"># Admin interface listen address and port</span>
<span class="n">VARNISH_ADMIN_LISTEN_ADDRESS</span><span class="o">=</span><span class="m">127</span><span class="o">.</span><span class="m">0</span><span class="o">.</span><span class="m">0</span><span class="o">.</span><span class="m">1</span>
<span class="n">VARNISH_ADMIN_LISTEN_PORT</span><span class="o">=</span><span class="m">6082</span>

<span class="c"># Shared secret file for admin interface</span>
<span class="n">VARNISH_SECRET_FILE</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">varnish</span><span class="o">/</span><span class="n">secret</span>

<span class="c"># Backend storage specification, see Storage Types in the varnishd(5)</span>
<span class="c"># man page for details.</span>
<span class="n">VARNISH_STORAGE</span><span class="o">=</span><span class="s">&quot;malloc,512M&quot;</span>

<span class="c"># Default TTL used when the backend does not specify one</span>
<span class="n">VARNISH_TTL</span><span class="o">=</span><span class="m">120</span>

<span class="c"># User and group for the varnishd worker processes</span>
<span class="n">VARNISH_USER</span><span class="o">=</span><span class="n">varnish</span>
<span class="n">VARNISH_GROUP</span><span class="o">=</span><span class="n">varnish</span>

<span class="c"># Other options, see the man page varnishd(1)</span>
<span class="n">DAEMON_OPTS</span><span class="o">=</span><span class="s">&quot;-p thread_pool_min=5 -p thread_pool_max=500 -p thread_pool_timeout=300&quot;</span>
</code></pre></div>
<h1 id="configure-apache-for-varnish">Configure Apache for Varnish</h1>
<p>Edit librenms.conf and modify the Apache Virtual Host listening port.</p>
<ul>
<li>Modify:<code>&lt;VirtualHost *:80&gt;</code> to: <code>&lt;VirtualHost *:8080&gt;</code></li>
</ul>
<div class="highlight"><pre><span></span><code>vim /etc/httpd/conf.d/librenms.conf
</code></pre></div>
<p>Varnish can not share a port with Apache. Change the Apache listening port to 8080.</p>
<ul>
<li>Modify:<code>Listen 80</code> to:<code>Listen 8080</code></li>
</ul>
<div class="highlight"><pre><span></span><code>vim /etc/httpd/conf/httpd.conf
</code></pre></div>
<ul>
<li>Create the librenms.vcl</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /etc/varnish
touch librenms.vcl
</code></pre></div>
<ul>
<li>Set ownership and permissions for Varnish files.</li>
</ul>
<div class="highlight"><pre><span></span><code>chown varnish:varnish default.vcl varnish.params secret
chmod <span class="m">644</span> default.vcl varnish.params secret
</code></pre></div>
<p>Edit the librenms.vcl.</p>
<div class="highlight"><pre><span></span><code>vim librenms.vcl
</code></pre></div>
<p>Paste example VCL config, read config comments for more information.</p>
<div class="highlight"><pre><span></span><code><span class="c">#</span>
<span class="c"># This is an example VCL file for Varnish.</span>
<span class="c">#</span>
<span class="c"># It does not do anything by default, delegating control to the</span>
<span class="c"># builtin VCL. The builtin VCL is called when there is no explicit</span>
<span class="c"># return statement.</span>
<span class="c">#</span>
<span class="c"># See the VCL chapters in the Users Guide at https://www.varnish-cache.org/docs/</span>
<span class="c"># and http://varnish-cache.org/trac/wiki/VCLExamples for more examples.</span>

<span class="c"># Marker to tell the VCL compiler that this VCL has been adapted to the</span>
<span class="c"># new 4.0 format.</span>
<span class="kr">vcl </span><span class="no">4.0</span><span class="p">;</span>

<span class="c"># Default backend definition. Set this to point to your Apache server.</span>
<span class="k">backend</span><span class="vg"> librenms</span><span class="p"> {</span>
    <span class="na">.host</span><span class="o"> = </span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">;</span>
    <span class="na">.port</span><span class="o"> = </span><span class="s">&quot;8080&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c"># In this example our objective is to cache static content with Varnish and temporarily</span>
<span class="c"># cache dynamic content in the client web browser.</span>

<span class="k">sub </span><span class="nf">vcl_recv</span><span class="p"> {</span>
    <span class="c"># HTTP requests from client web browser.</span>
    <span class="c"># Here we remove any cookie HTTP requests for the &#39;librenms.domain.net&#39; host</span>
    <span class="c"># containing the matching file extensions. We don&#39;t have to match by host if you</span>
    <span class="c"># only have LibreNMS running on Apache.</span>
    <span class="c"># If the cookies are not removed from the HTTP request then Varnish will not cache</span>
    <span class="c"># the files. &#39;else&#39; function is set to &#39;pass&#39;, or don&#39;t cache anything that doesn&#39;t</span>
    <span class="c"># match.</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">req.http.host</span> <span class="o">~</span> <span class="s">&quot;^librenms.domain.net&quot;</span><span class="p">)</span> <span class="o">{</span>
        <span class="k">set</span> <span class="nv">req.backend_hint</span> <span class="o">=</span> <span class="n">librenms</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">req.url</span> <span class="o">~</span> <span class="s">&quot;\.(png|gif|jpg|jpeg|ico|pdf|js|css|svg|eot|otf|woff|woff2|ttf)$&quot;</span><span class="p">)</span> <span class="o">{</span>
            <span class="k">unset</span> <span class="nv">req.http.Cookie</span><span class="p">;</span>
        <span class="o">}</span>

        <span class="k">else</span><span class="o">{</span>
            <span class="k">return</span><span class="p">(</span><span class="no">pass</span><span class="p">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">sub </span><span class="nf">vcl_backend_response</span><span class="p"> {</span>
    <span class="c"># &#39;sub vcl_backend_response&#39; is the same function as &#39;sub vcl_fetch&#39; in Varnish 3, however,</span>
    <span class="c"># the syntax is slightly different</span>
    <span class="c"># This function happens after we read the response headers from the backend (Apache).</span>
    <span class="c"># First function &#39;if (bereq.url ~ &quot;\&#39; removes cookies from the Apache HTTP responses</span>
    <span class="c"># that match the file extensions that are between the quotes, and cache the files for 24 hours.</span>
    <span class="c"># This assumes you update LibreNMS once a day, otherwise restart Varnish to clear cache.</span>
    <span class="c"># Second function &#39;if (bereq.url ~ &quot;^/&#39; removes the Pragma no-cache statements and sets the age</span>
    <span class="c"># of how long the client browser will cache the matching urls.</span>
    <span class="c"># LibreNMS graphs are updated every 300 seconds, &#39;max-age=300&#39; is set to match this behavior.</span>
    <span class="c"># We could cache these URLs in Varnish but it would add to the complexity of the config.</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">bereq.http.host</span> <span class="o">~</span> <span class="s">&quot;^librenms.domain.net&quot;</span><span class="p">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">bereq.url</span> <span class="o">~</span> <span class="s">&quot;\.(png|gif|jpg|jpeg|ico|pdf|js|css|svg|eot|otf|woff|woff2|ttf)$&quot;</span><span class="p">)</span> <span class="o">{</span>
            <span class="k">unset</span> <span class="nv">beresp.http.Set-cookie</span><span class="p">;</span>
            <span class="k">set</span> <span class="nv">beresp.ttl</span> <span class="o">=</span> <span class="ld">24h</span><span class="p">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">bereq.url</span> <span class="o">~</span> <span class="s">&quot;^/graph.php&quot;</span> <span class="o">||</span> <span class="s">&quot;^/device/&quot;</span> <span class="o">||</span> <span class="s">&quot;^/iftype/&quot;</span> <span class="o">||</span> <span class="s">&quot;^/customers/&quot;</span> <span class="o">||</span> <span class="s">&quot;^/health/&quot;</span> <span class="o">||</span> <span class="s">&quot;^/apps/&quot;</span> <span class="o">||</span> <span class="s">&quot;^/(plugin)$&quot;</span> <span class="o">||</span> <span class="s">&quot;^/(alert)$&quot;</span> <span class="o">||</span> <span class="s">&quot;^/eventlog/&quot;</span> <span class="o">||</span> <span class="s">&quot;^/graphs/&quot;</span> <span class="o">||</span> <span class="s">&quot;^/ports/&quot;</span> <span class="p">)</span> <span class="o">{</span>
            <span class="k">unset</span> <span class="nv">beresp.http.Pragma</span><span class="p">;</span>
            <span class="k">set</span> <span class="nv">beresp.http.Cache-Control</span> <span class="o">=</span> <span class="s">&quot;max-age=300&quot;</span><span class="p">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">sub </span><span class="nf">vcl_deliver</span><span class="p"> {</span>
    <span class="c"># Happens when we have all the pieces we need, and are about to send the</span>
    <span class="c"># response to the client.</span>
    <span class="c"># You can do accounting or modifying the final object here.</span>

    <span class="k">return</span> <span class="p">(</span><span class="no">deliver</span><span class="p">);</span>
<span class="o">}</span>
</code></pre></div>
<ul>
<li>Reload rules to remove the temporary port rule we added earlier.</li>
</ul>
<div class="highlight"><pre><span></span><code>firewall-cmd --reload
</code></pre></div>
<p>Varnish caching does not take effect immediately.  You will need to
browse the LibreNMS website to build up the cache.</p>
<p>Use the command <code>varnishstat</code> to monitor Varnish caching.  Over time
you should see 'MAIN.cache_hit' and 'MAIN.client_req' increase.  With
the above VCL the hit to request ratio is approximately 84%.</p>
<ul>
<li>
<p>Session based VCL (coming soon)</p>
</li>
<li>
<p>Testing and debugging VCL (coming soon)</p>
</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../Sub-Directory/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Sub-directory Support
              </div>
            </div>
          </a>
        
        
          <a href="../Dispatcher-Service/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Dispatcher Service (RC)
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.6a3d08fc.min.js"></script>
      <script src="../../assets/javascripts/bundle.71201edf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../librenms-docs.js"></script>
      
    
  </body>
</html>